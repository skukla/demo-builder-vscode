# Research: API Mesh Deployment Timeout Handling During Project Creation

**Date:** 2025-12-06
**Scope:** Codebase
**Depth:** Standard
**Purpose:** Implementation planning for retry/resume capability

---

## Summary

The codebase **partially accounts** for mesh deployment timeouts but has **significant UX gaps** when mesh fails during project creation. Mesh deployment is architecturally separable (Step 5 of 6) and manual redeploy exists post-creation, but users have **no recovery options** if mesh times out during the creation wizard.

---

## Codebase Analysis

### Relevant Files

| File | Purpose | Lines |
|------|---------|-------|
| `src/features/project-creation/handlers/executor.ts` | Mesh deployment in project creation (Step 5) | 294-376 |
| `src/features/project-creation/ui/steps/ProjectCreationStep.tsx` | Error state UI - **only "Back" button** | 100-120 |
| `src/features/mesh/services/meshDeploymentVerifier.ts` | Verification polling (10 attempts x 10s) | 42-156 |
| `src/core/utils/timeoutConfig.ts` | Timeout configs (120s for mesh) | 19-23 |
| `src/features/mesh/commands/deployMesh.ts` | Manual mesh redeploy command | 17-281 |
| `src/features/project-creation/handlers/createHandler.ts` | Creation handler + cleanup | 28-231 |
| `src/features/mesh/ui/steps/ApiMeshStep.tsx` | Mesh step UI (has better UX) | 46-111 |

### Current Architecture

**Project Creation Steps:**
```
Step 1: Create project directory (10%)
Step 2: Initialize project (15%)
Step 3: Load components (20%)
Step 4: Install components (25-80%)
Step 5: Deploy mesh (80-90%)     <- MESH HERE (separable)
Step 6: Finalize (90-100%)
```

**Timeout Configuration:**
- `API_MESH_UPDATE`: 120 seconds (2 min)
- `MESH_VERIFY_INITIAL_WAIT`: 20 seconds
- `MESH_VERIFY_POLL_INTERVAL`: 10 seconds (10 attempts)
- **Total verification window**: ~120 seconds

### Existing Patterns Found

1. **Mesh is architecturally separable** - Isolated in Step 5, not tightly coupled to component installation
2. **Soft failure on timeout** - Error message says "mesh may still be deploying"
3. **Manual redeploy exists** - `DeployMeshCommand` available from dashboard
4. **Safe cleanup** - Only deletes newly-created mesh, preserves pre-existing
5. **Pre-creation mesh check** - API Mesh step validates mesh availability before creation

### Critical Gaps Found

| Gap | Current Behavior | Impact |
|-----|------------------|--------|
| **No retry during creation** | "Back" button only | Must restart entire wizard |
| **No mesh-specific errors** | Generic "Project Creation Failed" | Users can't tell mesh vs component failure |
| **No elapsed time tracking** | "up to 3 minutes" static | Users don't know if close to completion |
| **Timeout = failure** | Timeout treated same as error | No distinction for "may still be running" |
| **No "Check Status"** | Can't poll mesh independently | Users can't know if mesh eventually deployed |

---

## Implementation Options

### Option 1: Retry Button in Error Dialog

**Approach:** Add "Retry Mesh Deployment" button to ProjectCreationStep error state

**Pros:**
- User control over retry timing
- Simple implementation
- Preserves existing workflow

**Cons:**
- User must click retry manually
- May not know when to retry

---

### Option 2: Skip & Continue Pattern

**Approach:** "Project created. Mesh deployment failed. Continue anyway?"

**Pros:**
- Project is usable without mesh
- Users can redeploy later from dashboard
- Doesn't block workflow

**Cons:**
- Incomplete project experience
- Users may forget to redeploy

---

### Option 3: Auto-Retry with Notification

**Approach:** One automatic retry after timeout, then show options

**Pros:**
- Handles transient issues automatically
- Reduces user intervention
- Best of both worlds

**Cons:**
- Longer total wait time
- More complex implementation

---

### Option 4: Separate UX Screen for Mesh Retry

**Approach:** Break mesh deployment into its own wizard step with dedicated UI

**Pros:**
- Full control over mesh deployment lifecycle
- Clear UX for "still deploying" vs "failed"
- Can show elapsed time and retry options
- Allows "skip for now" functionality

**Cons:**
- Architectural change to wizard
- More screens for user to navigate

---

## Common Pitfalls

1. **Treating timeout as failure** - Adobe meshes commonly take 2-3 minutes; 120s timeout is aggressive
2. **No exponential backoff** - Fixed polling interval doesn't adapt to load
3. **Project deletion on mesh timeout** - Currently projects survive mesh failure, but error UX treats it as fatal
4. **Hidden progress** - Users don't see verification attempts (0/10, 5/10, etc.)

---

## Key Takeaways

1. **Architecture supports separation** - Mesh deployment IS in its own step, just needs better error handling UI
2. **Manual redeploy exists** - Users CAN retry mesh after project creation via dashboard
3. **Gap is in wizard UX** - The missing piece is recovery options during project creation
4. **Prior research exists** - See `research.md` in this directory for earlier findings
5. **2-minute timeout may be too short** - Adobe mesh deployments commonly take 2-3 minutes

---

## Recommendations for Implementation Planning

### Immediate Improvements

1. **Add "Retry Mesh Deployment" button** to ProjectCreationStep error dialog
2. **Add mesh-specific error messaging** - Distinguish timeout from failure
3. **Show elapsed time** during mesh verification
4. **Extend timeout** from 120s to 180s

### Architectural Consideration

Consider breaking mesh deployment into a **separate wizard step** with:
- Dedicated progress UI showing verification attempts
- "Retry" / "Skip for now" / "Check Status" buttons
- Clear messaging about "still deploying" vs "failed"

This aligns with the query about "breaking up the creation step such that we have UX screens which account for just that piece."

---

## Related Files

- **Prior research:** `.rptc/research/api-mesh-deployment-timeout-handling/research.md`
- **Timeout config:** `src/core/utils/timeoutConfig.ts`
- **Mesh verifier:** `src/features/mesh/services/meshDeploymentVerifier.ts`
- **Project creation UI:** `src/features/project-creation/ui/steps/ProjectCreationStep.tsx`
