{
    "$schema": "./template-patches.schema.json",
    "version": "1.0.0",
    "patches": [
        {
            "id": "header-nav-tools-defensive",
            "filePath": "blocks/header/header.js",
            "description": "Makes header.js defensive when nav-tools section is missing. DA.live strips empty divs during content processing, causing nav to have only 2 sections (brand, sections) instead of 3 (brand, sections, tools). Without this patch, header.js crashes with 'Cannot read properties of null'."
        },
        {
            "id": "aem-assets-sku-sanitization",
            "filePath": "scripts/__dropins__/tools/lib/aem/assets.js",
            "description": "Auto-sanitizes SKU aliases in AEM Assets URL generation. Product SKUs containing forward slashes (e.g., 'apple-iphone-se/iphone-se') create invalid URLs. This patch modifies makeAemAssetsImageSlot to replace slashes with dashes automatically, eliminating the need to patch 16+ individual block files."
        },
        {
            "id": "product-link-sku-encoding",
            "filePath": "scripts/commerce.js",
            "description": "Decodes SKUs extracted from URLs to handle encoded forward slashes. SKUs with forward slashes are encoded as __ in URLs. This patch modifies getSkuFromUrl to decode __ back to / when extracting the SKU for Commerce API calls."
        },
        {
            "id": "product-link-sku-slash-encoding",
            "filePath": "scripts/commerce.js",
            "description": "Encodes forward slashes in SKUs before URL sanitization. Works with product-link-sku-encoding. The sanitizeName function destroys slash information by replacing non-alphanumeric chars with dashes. This patch pre-encodes slashes as __ before sanitization."
        },
        {
            "id": "personalization-auth-guard",
            "filePath": "scripts/initializers/personalization.js",
            "description": "Prevents 'Authorization header missing or empty' errors for anonymous users. The personalization dropin makes GraphQL queries requiring authentication on cart updates. This patch delays personalization initialization until user is authenticated."
        }
    ]
}
